const fileInput = document.getElementById('fileInput');
const videoPreview = document.getElementById('videoPreview');
const uploadZone = document.getElementById('upload-zone');
const previewContainer = document.getElementById('preview-container');
const headerText = document.getElementById('header-text');
const canvas = document.getElementById('telemetryCanvas');
const ctx = canvas.getContext('2d');
const speedTest = document.getElementById('speedTest');
const speedDisplay = document.getElementById('speedDisplay');

// Functie voor de Tesla-stijl Gauge
function drawGauge(speed) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 170;

    // Achtergrond ring
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
    ctx.lineWidth = 15;
    ctx.stroke();

    // Snelheid ring (Rood)
    const startAngle = -0.5 * Math.PI;
    const endAngle = startAngle + (speed / 250) * 2 * Math.PI;
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
    ctx.strokeStyle = '#E82127';
    ctx.lineWidth = 20;
    ctx.lineCap = 'round';
    ctx.stroke();

    // Tekst
    ctx.fillStyle = 'white';
    ctx.textAlign = 'center';
    ctx.font = 'bold 110px Inter, Arial';
    ctx.fillText(Math.round(speed), centerX, centerY + 20);
    
    ctx.font = 'bold 30px Inter, Arial';
    ctx.fillStyle = '#666';
    ctx.fillText('KM/H', centerX, centerY + 70);
}

// Upload actie
fileInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const url = URL.createObjectURL(file);
        videoPreview.src = url;
        
        // UI Wisselen
        uploadZone.classList.add('hidden');
        headerText.classList.add('hidden');
        previewContainer.classList.remove('hidden');
        
        // Start de animatie
        videoPreview.play();
        drawGauge(0);
    }
});

// Schuifregelaar koppelen aan meter
speedTest.addEventListener('input', (e) => {
    const val = e.target.value;
    speedDisplay.innerText = val + " KM/H";
    drawGauge(val);
});
